## 01 环境与依赖安装（开发机：Linux，本机 PostgreSQL + 两个 conda 环境）

本文目标：在一台新机器上，把“数据生成平台”（前端 `art-design-pro` + 后端 `vue-fastapi-admin-main` + 引擎 `ComfyUI-master-fitow`）的**基础运行环境**准备好。

---

## 1. 目录约定（本仓库结构）

你当前工作区（示例）：

- `art-design-pro/`：平台前端（Vue3 + TS + Vite + Element Plus）
- `vue-fastapi-admin-main/`：平台后端（FastAPI + Tortoise ORM + Aerich）
- `ComfyUI-master-fitow/`：ComfyUI 引擎（作为独立进程由后端按需拉起）
- `docs/`：本文档目录

---

## 2. 版本建议（约束尽量少，但要稳定）

- **OS**：Ubuntu 20.04+/22.04+（本文按 apt 写；其他发行版可自行换包管理器）
- **Node.js**：**20.19+**（`art-design-pro/package.json` 要求 `node>=20.19.0`）
- **Python（后端 conda 环境）**：3.11
- **Python（ComfyUI conda 环境）**：3.12（与后端隔离，降低依赖冲突风险）
- **PostgreSQL**：14/15/16 均可（生产建议 15+）

---

## 3. 安装系统依赖（Debian/Ubuntu）

```bash
sudo apt update
sudo apt install -y git curl wget build-essential pkg-config \
  libpq-dev python3-dev
```

说明：
- `libpq-dev`：后端 Python 依赖在编译/链接 PostgreSQL 客户端时可能需要（某些环境可省）

---

## 4. 安装 conda（Miniconda / Anaconda）

如果你已有 conda，可跳过。

- 建议：安装 Miniconda（更轻量），确保 `conda` 可用。
- 安装完成后建议执行一次：

```bash
conda config --set auto_activate_base false
```

---

## 5. 创建两个 conda 环境（推荐做法）

### 5.1 后端环境：`datagen-backend`

```bash
conda create -n datagen-backend python=3.11 -y
conda activate datagen-backend
python -V
```

依赖安装位置与方式：
- 后端依赖以 `vue-fastapi-admin-main` 项目为准（后续 `bootstrap` 脚本会做自动安装；手工安装见后端 README）。

### 5.2 ComfyUI 环境：`datagen-comfyui`

```bash
conda create -n datagen-comfyui python=3.12 -y
conda activate datagen-comfyui
python -V
```

说明：
- ComfyUI 的依赖（包括 PyTorch）建议严格在该环境内安装，避免污染后端环境。

---

## 6. 安装 Node.js（开发前端必需）

建议用 nvm 管理版本（若已安装 Node 可跳过）。

```bash
curl -fsSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
node -v
npm -v
```

可选：安装 pnpm（更快的依赖管理器）

```bash
npm i -g pnpm
pnpm -v
```

---

## 7. PostgreSQL 安装（本机 systemd 管理）

PostgreSQL 的安装、初始化、用户/数据库创建，见下一篇文档：`docs/02_PostgreSQL_安装与初始化规范.md`。

---

## 8. 下一步

- 完成 PostgreSQL 安装与初始化：见 `docs/02_PostgreSQL_安装与初始化规范.md`
- 配置前端/后端/ComfyUI 的环境变量：见 `docs/03_配置说明_前端后端ComfyUI.md`

