# 前端契约与后端适配差异清单（art-design-pro → vue-fastapi-admin-main）

> 目的：把 `art-design-pro` 现有前端请求与类型定义，明确为“契约”，并列出 `vue-fastapi-admin-main` 原生接口的差异与适配方式（避免前端改一套、后端跑一套）。\n

## 1. 证据来源（原文/源码）

- **前端官方定位/技术栈**：Art Design Pro 文档写明“核心框架：Vue 3、TypeScript、Vite；UI 组件库：Element Plus”（见 `https://www.artd.pro/docs/zh/guide/introduce.html`）。\n- **前端请求封装行为（源码事实）**：\n  - 请求拦截器把 `accessToken` 写入 `Authorization` 头：`art-design-pro/src/utils/http/index.ts`。\n  - 响应拦截器以响应体 `code` 判定成功（`ApiStatus.success=200`）：`art-design-pro/src/utils/http/status.ts`、`art-design-pro/src/utils/http/index.ts`。\n- **后端官方定位（原文）**：README 写明“RBAC 权限管理、动态路由和 JWT 鉴权”（见 `https://github.com/mizhexiaoxiao/vue-fastapi-admin`）。\n- **后端原生接口（源码事实）**：登录/用户信息/菜单接口在 `vue-fastapi-admin-main/app/api/v1/base/base.py`。\n

## 2. 契约主导结论（必须遵守）\n
- **鉴权头**：以 `Authorization` 头为准（需求文档也提到 `Authorization: Bearer <token>`），后端需兼容 `Authorization: <token>` 与 `Authorization: Bearer <token>`。\n- **响应约定**：前端默认只在响应体里识别 `code===200` 为成功，因此后端需稳定返回 `{ code, msg, data }`，并保证前端能读到 `msg`。\n- **菜单与权限**：后端菜单接口必须输出 `AppRouteRecord[]` 结构，并支持 `meta.authList[{title,authMark}]` 供 `v-auth/hasAuth` 使用。\n

## 3. 关键接口差异与适配（对照表）

| 能力 | art-design-pro 前端调用（契约） | vue-fastapi-admin 原生接口 | 适配方式（本仓库已实现） |
|---|---|---|---|
| 登录 | `POST /api/auth/login`，入参 `{ userName, password }`（见 `art-design-pro/src/api/auth.ts`） | `POST /api/v1/base/access_token`，入参 `{ username, password }`（见 `app/api/v1/base/base.py`） | 新增兼容接口 `POST /api/auth/login`，内部复用 `user_controller.authenticate` + `create_access_token`（见 `app/api/compat/auth.py`） |
| 用户信息 | `GET /api/user/info`（见 `art-design-pro/src/api/auth.ts`） | `GET /api/v1/base/userinfo`（见 `app/api/v1/base/base.py`） | 新增兼容接口 `GET /api/user/info`，返回 `{buttons,roles,userId,userName,email,avatar}`（见 `app/api/compat/users.py`） |
| 菜单 | `GET /api/v3/system/menus`（见 `art-design-pro/src/api/system-manage.ts`） | `GET /api/v1/base/usermenu`（见 `app/api/v1/base/base.py`） | 新增兼容接口 `GET /api/v3/system/menus`，并把后端 `Menu.component=\"Layout\"` 转换为前端期望的 `\"/index/index\"`（见 `app/api/compat/system.py`） |
| 用户列表（表格分页） | `GET /api/user/list`，参数 `{ current,size,... }`（见 `art-design-pro/src/api/system-manage.ts` 与 `useTable` 默认分页键） | `GET /api/v1/user/list`，参数 `{ page,page_size,... }`（见 `app/api/v1/users/users.py`） | 新增兼容接口 `GET /api/user/list`，返回 `data:{records,current,size,total}`（见 `app/api/compat/users.py`） |
| 角色列表（表格分页） | `GET /api/role/list`，参数 `{ current,size,... }` | `GET /api/v1/role/list`（见后端路由结构） | 新增兼容接口 `GET /api/role/list`，返回 `data:{records,current,size,total}`（见 `app/api/compat/roles.py`） |

## 4. 备注：为什么要把“业务错误”也做成 HTTP 200\n

前端请求层默认只接受 2xx 响应并在响应体里解析 `code`（见 `art-design-pro/src/utils/http/index.ts`），如果后端用 HTTP 400/422 返回业务错误，前端会进入 Axios error 分支且错误提示会退化为通用文案。\n因此本仓库将统一响应与异常处理调整为：**HTTP 200 + 响应体 code 表达业务状态**（见 `vue-fastapi-admin-main/app/schemas/base.py`、`app/core/exceptions.py`）。\n

